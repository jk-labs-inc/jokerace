import AddEntryChargeContract from "@contracts/bytecodeAndAbi/Contest.4.1.addEntryCharge.sol/Contest.json";
import RmImmutableKeywordContract from "@contracts/bytecodeAndAbi/Contest.4.10.rmImmutableKeyword.sol/Contest.json";
import GasOptimizeGettersContract from "@contracts/bytecodeAndAbi/Contest.4.11.gasOptimizeGetters.sol/Contest.json";
import AllowCancelCompletedContract from "@contracts/bytecodeAndAbi/Contest.4.12.allowCancelCompleted.sol/Contest.json";
import AddCommentsContract from "@contracts/bytecodeAndAbi/Contest.4.13.addComments.sol/Contest.json";
import RmShadowingPropIdsContract from "@contracts/bytecodeAndAbi/Contest.4.14.rmShadowingPropIds.sol/Contest.json";
import RmUnusedViewFuncContract from "@contracts/bytecodeAndAbi/Contest.4.15.rmUnusedViewFunc.sol/Contest.json";
import PinAllToSameContract from "@contracts/bytecodeAndAbi/Contest.4.16.pinAllToSame.sol/Contest.json";
import MitToAGPLContract from "@contracts/bytecodeAndAbi/Contest.4.17.mitToAGPL.sol/Contest.json";
import AddEmergencyFuncsContract from "@contracts/bytecodeAndAbi/Contest.4.18.addEmergencyFuncs.sol/Contest.json";
import AddMoreAttributionContract from "@contracts/bytecodeAndAbi/Contest.4.19.addMoreAttribution.sol/Contest.json";
import UpdateSortingAlgoContract from "@contracts/bytecodeAndAbi/Contest.4.2.updateSortingAlgo.sol/Contest.json";
import AddGetDeletedAuthorsContract from "@contracts/bytecodeAndAbi/Contest.4.20.addGetDeletedAuthors.sol/Contest.json";
import AddContentToEventsContract from "@contracts/bytecodeAndAbi/Contest.4.21.addContentToEvents.sol/Contest.json";
import RefactorDistributionFuncContract from "@contracts/bytecodeAndAbi/Contest.4.22.refactorDistributionFunc.sol/Contest.json";
import AddCostToVoteContract from "@contracts/bytecodeAndAbi/Contest.4.23.addCostToVote.sol/Contest.json";
import RefactorCostDistroContract from "@contracts/bytecodeAndAbi/Contest.4.24.refactorCostDistro.sol/Contest.json";
import PayPerVoteContract from "@contracts/bytecodeAndAbi/Contest.4.25.payPerVote.sol/Contest.json";
import CleanUpConstructorsContract from "@contracts/bytecodeAndAbi/Contest.4.26.cleanUpConstructors.sol/Contest.json";
import AnyoneCanVoteContract from "@contracts/bytecodeAndAbi/Contest.4.27.anyoneCanVote.sol/Contest.json";
import UpdateForgeLibsContract from "@contracts/bytecodeAndAbi/Contest.4.28.updateForgeLibs.sol/Contest.json";
import SetSplitDestinationContract from "@contracts/bytecodeAndAbi/Contest.4.29.setSplitDestination.sol/Contest.json";
import NewValueAlreadyInArrayContract from "@contracts/bytecodeAndAbi/Contest.4.3.newValueAlreadyInArray.sol/Contest.json";
import MakeJkLabsSplitConfigurableContract from "@contracts/bytecodeAndAbi/Contest.4.30.makeJkLabsSplitConfigurable.sol/Contest.json";
import AddMetadataFieldsContract from "@contracts/bytecodeAndAbi/Contest.4.31.addMetadataFields.sol/Contest.json";
import CheckCanceledContract from "@contracts/bytecodeAndAbi/Contest.4.32.checkCanceled.sol/Contest.json";
import MustCancelToWithdrawContract from "@contracts/bytecodeAndAbi/Contest.4.33.mustCancelToWithdraw.sol/Contest.json";
import AllowJkLabsDestUpdateContract from "@contracts/bytecodeAndAbi/Contest.4.34.allowJkLabsDestUpdate.sol/Contest.json";
import OnlyCreatorChangeMerkleContract from "@contracts/bytecodeAndAbi/Contest.4.35.onlyCreatorChangeMerkle.sol/Contest.json";
import NoCommentAfterCloseContract from "@contracts/bytecodeAndAbi/Contest.4.36.noCommentAfterClose.sol/Contest.json";
import EditTitleDescContract from "@contracts/bytecodeAndAbi/Contest.4.37.editTitleDesc.sol/Contest.json";
import UseCustomErrorsContract from "@contracts/bytecodeAndAbi/Contest.4.4.useCustomErrors.sol/Contest.json";
import CleanUpSortingContract from "@contracts/bytecodeAndAbi/Contest.4.5.cleanUpSorting.sol/Contest.json";
import RestructureExtensionsAndUtilsContract from "@contracts/bytecodeAndAbi/Contest.4.6.restructureExtensionsAndUtils.sol/Contest.json";
import RmUnnecessaryVirtualsContract from "@contracts/bytecodeAndAbi/Contest.4.7.rmUnnecessaryVirtuals.sol/Contest.json";
import DeleteInMapAfterForLoopContract from "@contracts/bytecodeAndAbi/Contest.4.8.deleteInMapAfterForLoop.sol/Contest.json";
import AddGetPropIdsWithForVotesContract from "@contracts/bytecodeAndAbi/Contest.4.9.addGetPropIdsWithForVotes.sol/Contest.json";
import RmDownvotingContract from "@contracts/bytecodeAndAbi/Contest.5.1.rmDownvoting.sol/Contest.json";
import AddErc20CancelledCheckContract from "@contracts/bytecodeAndAbi/Contest.5.2.addErc20CancelledCheck.sol/Contest.json";
import EntrantsCanDeleteContract from "@contracts/bytecodeAndAbi/Contest.5.3.entrantsCanDelete.sol/Contest.json";
import OfficialModulePointsToContestContract from "@contracts/bytecodeAndAbi/Contest.5.4.officialModulePointsToContest.sol/Contest.json";
import VoterRewardsContract from "@contracts/bytecodeAndAbi/Contest.5.5.voterRewards.sol/Contest.json";
import SetPeriodLimitsContract from "@contracts/bytecodeAndAbi/Contest.5.6.setPeriodLimits.sol/Contest.json";
import VotingPriceCurvesContract from "@contracts/bytecodeAndAbi/Contest.5.7.votingPriceCurves.sol/Contest.json";
import AddModuleTrackingContract from "@contracts/bytecodeAndAbi/Contest.5.8.addModuleTracking.sol/Contest.json";
import CalcCorrectMinuteContract from "@contracts/bytecodeAndAbi/Contest.5.9.calcCorrectMinute.sol/Contest.json";
import OnlyDeleteInEntryContract from "@contracts/bytecodeAndAbi/Contest.5.10.onlyDeleteInEntry.sol/Contest.json";
import AntiRugContract from "@contracts/bytecodeAndAbi/Contest.5.11.antiRug.sol/Contest.json";
import CorrectDelayVarContract from "@contracts/bytecodeAndAbi/Contest.5.12.correctDelayVar.sol/Contest.json";
import RankLimitCheckContract from "@contracts/bytecodeAndAbi/Contest.5.13.rankLimitCheck.sol/Contest.json";
import RmEntryRewardsContract from "@contracts/bytecodeAndAbi/Contest.5.14.rmEntryRewards.sol/Contest.json";
import VoteAndEarnOnlyContract from "@contracts/bytecodeAndAbi/Contest.6.1.voteAndEarnOnly.sol/Contest.json";
import RmDeleteVotesUpdateContract from "@contracts/bytecodeAndAbi/Contest.6.2.rmDeleteVotesUpdate.sol/Contest.json";
import DocsDeleteOnlyInEntryContract from "@contracts/bytecodeAndAbi/Contest.6.3.docsDeleteOnlyInEntry.sol/Contest.json";
import RmUnusedErrorsContract from "@contracts/bytecodeAndAbi/Contest.6.4.rmUnusedErrors.sol/Contest.json";
import OnlySetOfficialModuleOnceContract from "@contracts/bytecodeAndAbi/Contest.6.5.onlySetOfficialModuleOnce.sol/Contest.json";
import FixStateErrorsContract from "@contracts/bytecodeAndAbi/Contest.6.6.fixStateErrors.sol/Contest.json";
import UpdatePeriodConstraintsContract from "@contracts/bytecodeAndAbi/Contest.6.7.updatePeriodConstraints.sol/Contest.json";
import CorrectPeriodConstraintsContract from "@contracts/bytecodeAndAbi/Contest.6.8.correctPeriodConstraints.sol/Contest.json";
import AlwaysSelfFundContract from "@contracts/bytecodeAndAbi/Contest.6.9.alwaysSelfFund.sol/Contest.json";
import DeployedContestContract from "@contracts/bytecodeAndAbi/Contest.sol/Contest.json";
import { MAX_TIME_TO_WAIT_FOR_RPC, executeWithTimeout } from "./timeout";
import { createTransport } from "@config/wagmi/transports";
import { Chain, createPublicClient, getContract } from "viem";
import { getChainFromId } from "./getChainFromId";

export async function getContestContractVersion(address: string, chainId: number) {
  try {
    const chain = getChainFromId(chainId);
    const client = createPublicClient({
      chain: chain,
      transport: createTransport(chain as Chain),
    });

    // Get earliest ABI just so we can call VERSION() to start, since we know all ABIs will have that function
    const contract = getContract({
      address: address as `0x${string}`,
      client,
      abi: AddEntryChargeContract.abi,
    });

    // Here we check if all RPC calls are successful, otherwise we throw an error and return empty ABI
    const version = (await executeWithTimeout(MAX_TIME_TO_WAIT_FOR_RPC, contract.read.version())) as string;

    const defaultReturn = { abi: null, version: "unknown" };
    if (version === "6.9") {
      return { abi: AlwaysSelfFundContract.abi, version };
    } else if (version === "6.8") {
      return { abi: CorrectPeriodConstraintsContract.abi, version };
    } else if (version === "6.7") {
      return { abi: UpdatePeriodConstraintsContract.abi, version };
    } else if (version === "6.6") {
      return { abi: FixStateErrorsContract.abi, version };
    } else if (version === "6.5") {
      return { abi: OnlySetOfficialModuleOnceContract.abi, version };
    } else if (version === "6.4") {
      return { abi: RmUnusedErrorsContract.abi, version };
    } else if (version === "6.3") {
      return { abi: DocsDeleteOnlyInEntryContract.abi, version };
    } else if (version === "6.2") {
      return { abi: RmDeleteVotesUpdateContract.abi, version };
    } else if (version === "6.1") {
      return { abi: VoteAndEarnOnlyContract.abi, version };
    } else if (version === "5.14") {
      return { abi: RmEntryRewardsContract.abi, version };
    } else if (version === "5.13") {
      return { abi: RankLimitCheckContract.abi, version };
    } else if (version === "5.12") {
      return { abi: CorrectDelayVarContract.abi, version };
    } else if (version === "5.11") {
      return { abi: AntiRugContract.abi, version };
    } else if (version === "5.10") {
      return { abi: OnlyDeleteInEntryContract.abi, version };
    } else if (version === "5.9") {
      return { abi: CalcCorrectMinuteContract.abi, version };
    } else if (version === "5.8") {
      return { abi: AddModuleTrackingContract.abi, version };
    } else if (version === "5.7") {
      return { abi: VotingPriceCurvesContract.abi, version };
    } else if (version === "5.6") {
      return { abi: SetPeriodLimitsContract.abi, version };
    } else if (version === "5.5") {
      return { abi: VoterRewardsContract.abi, version };
    } else if (version === "5.4") {
      return { abi: OfficialModulePointsToContestContract.abi, version };
    } else if (version === "5.3") {
      return { abi: EntrantsCanDeleteContract.abi, version };
    } else if (version === "5.2") {
      return { abi: AddErc20CancelledCheckContract.abi, version };
    } else if (version === "5.1") {
      return { abi: RmDownvotingContract.abi, version };
    } else if (version === "4.37") {
      return { abi: EditTitleDescContract.abi, version };
    } else if (version === "4.36") {
      return { abi: NoCommentAfterCloseContract.abi, version };
    } else if (version === "4.35") {
      return { abi: OnlyCreatorChangeMerkleContract.abi, version };
    } else if (version === "4.34") {
      return { abi: AllowJkLabsDestUpdateContract.abi, version };
    } else if (version === "4.33") {
      return { abi: MustCancelToWithdrawContract.abi, version };
    } else if (version === "4.32") {
      return { abi: CheckCanceledContract.abi, version };
    } else if (version === "4.31") {
      return { abi: AddMetadataFieldsContract.abi, version };
    } else if (version === "4.30") {
      return { abi: MakeJkLabsSplitConfigurableContract.abi, version };
    } else if (version === "4.29") {
      return { abi: SetSplitDestinationContract.abi, version };
    } else if (version === "4.28") {
      return { abi: UpdateForgeLibsContract.abi, version };
    } else if (version === "4.27") {
      return { abi: AnyoneCanVoteContract.abi, version };
    } else if (version === "4.26") {
      return { abi: CleanUpConstructorsContract.abi, version };
    } else if (version === "4.25") {
      return { abi: PayPerVoteContract.abi, version };
    } else if (version === "4.24") {
      return { abi: RefactorCostDistroContract.abi, version };
    } else if (version === "4.23") {
      return { abi: AddCostToVoteContract.abi, version };
    } else if (version === "4.22") {
      return { abi: RefactorDistributionFuncContract.abi, version };
    } else if (version === "4.21") {
      return { abi: AddContentToEventsContract.abi, version };
    } else if (version === "4.20") {
      return { abi: AddGetDeletedAuthorsContract.abi, version };
    } else if (version === "4.19") {
      return { abi: AddMoreAttributionContract.abi, version };
    } else if (version === "4.18") {
      return { abi: AddEmergencyFuncsContract.abi, version };
    } else if (version === "4.17") {
      return { abi: MitToAGPLContract.abi, version };
    } else if (version === "4.16") {
      return { abi: PinAllToSameContract.abi, version };
    } else if (version === "4.15") {
      return { abi: RmUnusedViewFuncContract.abi, version };
    } else if (version === "4.14") {
      return { abi: RmShadowingPropIdsContract.abi, version };
    } else if (version === "4.13") {
      return { abi: AddCommentsContract.abi, version };
    } else if (version === "4.12") {
      return { abi: AllowCancelCompletedContract.abi, version };
    } else if (version === "4.11") {
      return { abi: GasOptimizeGettersContract.abi, version };
    } else if (version === "4.10") {
      return { abi: RmImmutableKeywordContract.abi, version };
    } else if (version === "4.9") {
      return { abi: AddGetPropIdsWithForVotesContract.abi, version };
    } else if (version === "4.8") {
      return { abi: DeleteInMapAfterForLoopContract.abi, version };
    } else if (version === "4.7") {
      return { abi: RmUnnecessaryVirtualsContract.abi, version };
    } else if (version === "4.6") {
      return { abi: RestructureExtensionsAndUtilsContract.abi, version };
    } else if (version === "4.5") {
      return { abi: CleanUpSortingContract.abi, version };
    } else if (version === "4.4") {
      return { abi: UseCustomErrorsContract.abi, version };
    } else if (version === "4.3") {
      return { abi: NewValueAlreadyInArrayContract.abi, version };
    } else if (version === "4.2") {
      return { abi: UpdateSortingAlgoContract.abi, version };
    } else if (version === "4.1") {
      return { abi: AddEntryChargeContract.abi, version };
    } else {
      return { abi: DeployedContestContract.abi, version };
    }
  } catch (error: unknown) {
    console.error(`Error while fetching the contract version for address ${address} on chainId ${chainId}:`, error);
    return { abi: null, version: "error" };
  }
}

export default getContestContractVersion;
